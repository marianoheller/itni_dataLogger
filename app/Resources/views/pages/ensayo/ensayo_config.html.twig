{% extends 'pages/ensayo_base.html.twig' %}


{% block configEnsayo %}
    {% if flagEnsayoRunning == true %}
        <!-- Modal -->
        <div id="modalEnsayoRunning" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        {#<button type="button" class="close" data-dismiss="modal">&times;</button>#}
                        <h4 class="modal-title">Ensayo ya iniciado</h4>
                    </div>
                    <div class="modal-body">
                        <div id="alertFailedCancel" class="alert alert-danger">
                            <button onclick="hideFailedCancelAlert()" type="button" class="close">&times;</button>
                            <strong>Error!</strong> No se pudo cancelar ensayo.
                        </div>
                        {#<p>Ensayo actualmente corriendo.</p>#}
                        <small>
                            <div class="container">
                                <ul class="list-group" style="text-align: left">
                                    <li class="list-group-item list-group-item-info">Iniciado: {{ arrayQueryResult[0]["t_inicio"] }}</li>
                                    <li class="list-group-item list-group-item-info">Ultima actualización: {{ arrayQueryResult[0]["lastPing"] }}</li>
                                    <li class="list-group-item list-group-item-info">Titulo: {{ arrayQueryResult[0]["titulo"] }}</li>
                                    <li class="list-group-item list-group-item-info">Responsable: {{ arrayQueryResult[0]["responsable"] }}</li>
                                    <li class="list-group-item list-group-item-info">OT: {{ arrayQueryResult[0]["OT"] }}</li>
                                    <li class="list-group-item list-group-item-info">SOT: {{ arrayQueryResult[0]["SOT"] }}</li>
                                    <li class="list-group-item list-group-item-info">Descripción: {{ arrayQueryResult[0]["descripcion"] }}</li>
                                </ul>
                            </div>
                        </small>
                        <p>¿Que desea hacer?</p>
                    </div>
                    <div class="modal-footer">
                        <button  onclick="goHome()" type="button" class="btn btn-default" data-dismiss="modal">Atrás</button>
                        <button onclick="cancelarEnsayo()" type="button" class="btn btn-danger">Cancelar ensayo</button>
                        <button onclick="resumirEnsayo()" type="button" class="btn btn-primary">Resumir ensayo</button>
                    </div>
                </div>

            </div>
        </div>
    {% endif %}

    <h1>Generar ensayo</h1>
    <p class="lead">Selecciones la configuracion deseada e inicie el ensayo.</p>

    <form class="form-horizontal" method="post" action="/ensayo/now">

        <div class="form-group">
            <label for="inputTitulo">Titulo ensayo</label>
            <input name="Titulo" type="text" class="form-control" id="inputTitulo" placeholder="Titulo ensayo">
            {#<small class="text-muted">We'll never share your email with anyone else.</small>#}
        </div>

        <div class="form-group">
            <label for="inputResponsable">Responsable</label>
            <input name="Responsable" type="text" class="form-control" id="inputResponsable" placeholder="Nombre responsable">
            {#<small class="text-muted">We'll never share your email with anyone else.</small>#}
        </div>

        <div class="form-group">
            <label for="inputCliente">Cliente</label>
            <input name="Cliente" type="text" class="form-control" id="inputCliente" placeholder="Cliente">
            {#<small class="text-muted">We'll never share your email with anyone else.</small>#}
        </div>

        <div class="form-group">
            <label for="inputOT">Nº OT</label>
            <input name="OT" type="text" class="form-control" id="inputOT" placeholder="Nº OT">
        </div>

        <div class="form-group">
            <label for="inputSOT">Nº SOT</label>
            <input name="SOT" type="text" class="form-control" id="inputSOT" placeholder="Nº SOT">
        </div>

        <div class="form-group">
            <label for="inputDescripcion">Descripcion</label>
            <textarea name="Descripcion" class="form-control" id="inputDescripcion" rows="3" placeholder="Descripcion"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Comenzar ensayo</button>
    </form>
{% endblock %}


{% block ensayoJavascript %}
    <script>
        {% if flagEnsayoRunning == true %}
        $(document).ready(function() {

            $('#modalEnsayoRunning').modal({
                backdrop: 'static',
                keyboard: false
            })
            $('#modalEnsayoRunning').modal('show');
            $('#alertFailedCancel').hide();
        });

        function goBack() {
            window.history.back();
        }

        function goHome() {
            window.location.replace("/");
        }

        function hideFailedCancelAlert(){
            $('#alertFailedCancel').hide();
        }

        function cancelarEnsayo() {
            $.ajax({
                        url: '/ensayo/cancel/all',
                        type:'POST',
                        contentType: "application/json; charset=utf-8",
                        //data: jsonToSend,
                        dataType: 'json'
                    })
                    .done(function (results) {
                        $('#modalEnsayoRunning').modal('hide');
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        $('#alertFailedCancel').show();
                    });
        }

        function resumirEnsayo() {
            goHome();
        }

        {% endif %}
    </script>


{% endblock %}